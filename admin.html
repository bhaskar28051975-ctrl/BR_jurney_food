<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin - BR Journey Food</title>
<style>
  :root{ --primary:#0b66c3; --dark:#09324a; --muted:#8f9fb3; --card:#fff; --bg:#f2f6fa; }
  body{ font-family:"Segoe UI",Arial; margin:0; background:var(--bg); padding:18px; color:var(--dark); }
  .container{ max-width:980px; margin:0 auto; }
  .header{ display:flex;justify-content:space-between;align-items:center;margin-bottom:12px; }
  .card{ background:var(--card); padding:14px; border-radius:12px; box-shadow:0 10px 28px rgba(10,30,60,0.06); border:1px solid rgba(12,40,80,0.04); margin-bottom:12px;}
  .btn{ padding:8px 12px; border-radius:8px; border:none; cursor:pointer; font-weight:800; }
  .btn-refresh{ background:linear-gradient(90deg,var(--primary),#0a85ff); color:white; }
  .btn-update{ background:#0b8b3a; color:white; }
  .btn-delete{ background:#e23b3b; color:white; }
  table{ width:100%; border-collapse:collapse; }
  th,td{ padding:10px; text-align:left; border-bottom:1px solid #f1f5fb; }
  select{ padding:8px; border-radius:8px; }
  .small{ font-size:13px; color:var(--muted); }
  a{ color:var(--primary) }
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h2>Admin Dashboard</h2>
      <div><button class="btn btn-refresh" onclick="refreshList()">Refresh</button></div>
    </div>

    <div id="ordersArea"></div>

    <p class="small">Note: This admin uses local browser storage. To share between devices implement a server or Google Sheets/Firebase backend.</p>
    <p><a href="index.html">← Back to Order Page</a></p>
  </div>

<script>
  const STATUS = ['Pending','Preparing','Dispatched','Delivered'];

  function refreshList(){
    const area = document.getElementById('ordersArea');
    area.innerHTML = '';
    const raw = localStorage.getItem('br_orders');
    if(!raw){ area.innerHTML = '<div class="card">No orders yet.</div>'; return; }
    const arr = JSON.parse(raw);
    if(arr.length === 0){ area.innerHTML = '<div class="card">No orders yet.</div>'; return; }

    arr.forEach(o => {
      const wrapper = document.createElement('div');
      wrapper.className = 'card';
      wrapper.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px">
          <div style="flex:1">
            <div><strong>Order ID:</strong> ${o.id}</div>
            <div class="small">Placed: ${new Date(o.createdAt).toLocaleString()}</div>
            <div style="margin-top:8px"><strong>Customer:</strong> ${o.name} • ${o.phone}</div>
            <div style="margin-top:6px"><strong>Address:</strong> ${o.address}</div>
            <div style="margin-top:8px"><strong>Items:</strong><ul>${o.items.map(i=>`<li>${i.sku} — Qty:${i.qty} — ₹${i.total}</li>`).join('')}</ul></div>
          </div>
          <div style="width:220px;text-align:right">
            <div style="font-size:18px;font-weight:900;margin-bottom:10px">₹${o.grandTotal}</div>
            <div style="margin-bottom:10px">
              <select id="status-${o.id}">
                ${STATUS.map(s=>`<option ${s===o.status ? 'selected' : ''}>${s}</option>`).join('')}
              </select>
            </div>
            <div style="display:flex;gap:8px;justify-content:flex-end">
              <button class="btn btn-update" onclick="updateStatus('${o.id}')">Update</button>
              <button class="btn btn-delete" onclick="deleteOrder('${o.id}')">Delete</button>
            </div>
          </div>
        </div>
      `;
      area.appendChild(wrapper);
    });
  }

  function updateStatus(id){
    const sel = document.getElementById('status-'+id);
    if(!sel) return alert('Status control not found.');
    const newStatus = sel.value;
    const raw = localStorage.getItem('br_orders');
    if(!raw) return alert('No orders in storage.');
    const arr = JSON.parse(raw);
    const idx = arr.findIndex(x => x.id === id);
    if(idx === -1) return alert('Order not found.');
    arr[idx].status = newStatus;
    localStorage.setItem('br_orders', JSON.stringify(arr));
    alert('Status updated to ' + newStatus);
    refreshList();
  }

  function deleteOrder(id){
    if(!confirm('Delete order ' + id + '?')) return;
    const raw = localStorage.getItem('br_orders');
    if(!raw) return;
    let arr = JSON.parse(raw);
    arr = arr.filter(x => x.id !== id);
    localStorage.setItem('br_orders', JSON.stringify(arr));
    alert('Order deleted.');
    refreshList();
  }

  document.addEventListener('DOMContentLoaded', refreshList);
</script>
</body>
</html>
